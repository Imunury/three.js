<!DOCTYPE html>
<html>
    <head>

        <title>3D Water Simulation</title>
        <style>
        body { margin: 0; }
        canvas { display: block; }
        #heightInput { position: absolute; top: 1rem; left: 1rem; z-index: 100; }
    </style>
    </style>
    </head>
    <body>
        <input id="heightInput" type="number" placeholder="Enter height...">
        <script type="module">
            import * as THREE from 'https://unpkg.com/three/build/three.module.js';

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            
            camera.position.set(20, 20, 20);
            camera.lookAt(new THREE.Vector3(0, 0, 0));
            
            // 물의 표면 생성
            const waterTexture = new THREE.TextureLoader().load('../public/water-7395510_1920.jpg'); // 실제 텍스처 경로로 변경
            waterTexture.wrapS = waterTexture.wrapT = THREE.RepeatWrapping;
            const waterMaterial = new THREE.MeshBasicMaterial({ map: waterTexture, side: THREE.DoubleSide });
            const waterGeometry = new THREE.PlaneGeometry(20, 30, 32, 32);
            const water = new THREE.Mesh(waterGeometry, waterMaterial);
            water.rotation.x = -Math.PI / 2;
            //ater.position.y += 5; // 물의 표면을 y축 방향으로 2단위만큼 올림

            scene.add(water);

            // 사이드 벽 생성
            const sideMaterial = new THREE.MeshBasicMaterial({ map: waterTexture });
            const sideGeometry = new THREE.BoxGeometry(20, 1, 30);
            const side = new THREE.Mesh(sideGeometry, sideMaterial);
            scene.add(side);

            
            // 물이 흐르는 효과
            function animate() {
                requestAnimationFrame(animate);

                const time = performance.now() * 0.001;
                const positions = waterGeometry.attributes.position.array;
                
                for (let i = 0; i < positions.length; i += 3) {
                    // X와 Y 좌표에 따라 높이 변화를 줌으로써 물결 효과 생성
                    const x = positions[i];
                    const y = positions[i + 1];
                    positions[i + 2] = Math.sin(x * 2 + time) * Math.cos(y * 2 + time) * 0.5;
                }

                waterGeometry.attributes.position.needsUpdate = true;

                // 물과 사이드 벽의 텍스처 오프셋을 애니메이션으로 조정
                const offsetSpeed = 0.001; // 텍스처 이동 속도
                waterTexture.offset.y -= offsetSpeed;
                // sideMaterial.map.offset.y -= offsetSpeed; // 사이드 벽 텍스처도 함께 이동

                renderer.render(scene, camera);
            }
            
            animate();

            document.getElementById('heightInput').addEventListener('change', function(e) {
                const height = parseFloat(e.target.value);
                // Update the side and water position based on the input value
                side.position.y = height / 2; // Adjust based on the center of the geometry
                water.position.y = height; // Set water position to the input value
                side.scale.y = height; // Scale side to match the input height
            });
    </script>
    </body>
</html>
